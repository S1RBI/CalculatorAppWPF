<Window x:Class="CalculatorApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:CalculatorApp"
        Title="Калькулятор покрытий" Height="900" Width="1400"
        Background="#F8F9FA" WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        MinHeight="700" MinWidth="1000">

    <Window.Resources>
        <!-- Конвертеры -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Современные цвета -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#00a550"/>
        <SolidColorBrush x:Key="PrimaryHoverBrush" Color="#008a43"/>
        <SolidColorBrush x:Key="PrimaryActiveBrush" Color="#007a3d"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#10B981"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BackgroundBrush" Color="#F8F9FA"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#111827"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#6B7280"/>

        <!-- Унифицированная кнопка -->
        <Style TargetType="Button" x:Key="BaseButton">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Padding" Value="16,0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.02" ScaleY="1.02"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Основная кнопка -->
        <Style TargetType="Button" x:Key="PrimaryButton" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryHoverBrush}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryHoverBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Вторичная кнопка -->
        <Style TargetType="Button" x:Key="SecondaryButton" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F3F4F6"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Кнопка навигации -->
        <Style TargetType="Button" x:Key="NavButton" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F3F4F6"/>
                    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                </Trigger>
                <Trigger Property="Tag" Value="Active">
                    <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Кнопка действия -->
        <Style TargetType="Button" x:Key="ActionButton" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="MinWidth" Value="40"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F3F4F6"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Современный TextBox -->
        <Style TargetType="TextBox" x:Key="ModernTextBox">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          VerticalAlignment="Center"
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Современный PasswordBox -->
        <Style TargetType="PasswordBox" x:Key="ModernPasswordBox">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="12,0,50,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="PasswordBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          VerticalAlignment="Center"
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Контейнер для пароля с кнопкой показа -->
        <Style TargetType="Grid" x:Key="PasswordContainerStyle">
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- Кнопка показа пароля -->
        <Style TargetType="Button" x:Key="PasswordToggleButton">
            <Setter Property="Width" Value="35"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F3F4F6"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#E5E7EB"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Современный ComboBox -->
        <Style TargetType="ComboBox" x:Key="ModernComboBox">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="12,0,40,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"
                                          Background="{TemplateBinding Background}"
                                          Focusable="false"
                                          IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="30"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- Стрелка вниз -->
                                                <Path Grid.Column="1" 
                                                      Fill="{StaticResource TextSecondaryBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      Width="12" Height="8"
                                                      Data="M0,0 L6,6 L12,0 Z"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              HorizontalAlignment="Left"/>
                            <Popup Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            CornerRadius="8">
                                        <Border.Effect>
                                            <DropShadowEffect Color="#000000" Opacity="0.1" BlurRadius="8" ShadowDepth="2"/>
                                        </Border.Effect>
                                        <ScrollViewer Margin="0" SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="ToggleButton" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                <Setter TargetName="ToggleButton" Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ToggleButton" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для карточек -->
        <Style TargetType="Border" x:Key="CardStyle">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.06" BlurRadius="12" ShadowDepth="4"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для строк таблицы -->
        <Style TargetType="Border" x:Key="TableRowStyle">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="20,16"/>
            <Setter Property="Margin" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F9FAFB"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для ошибок -->
        <Style TargetType="Border" x:Key="ErrorCardStyle">
            <Setter Property="Background" Value="#FEF2F2"/>
            <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,12,0,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Компактная верхняя навигация -->
        <Border Grid.Row="0" Background="White" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Логотип и заголовок -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Border Width="40" Height="40" Background="{StaticResource PrimaryBrush}" CornerRadius="20" Margin="0,0,12,0">
                        <TextBlock Text="📊" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Калькулятор покрытий" FontSize="18" FontWeight="Bold" 
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock Text="Профессиональный расчет стоимости" FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Навигационные кнопки -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="CalculatorNavButton" Content="📊 Калькулятор" Style="{StaticResource NavButton}" 
                            Tag="Active" Click="NavigateToCalculator"/>
                    <Button x:Name="AdminNavButton" Content="⚙️ Администрирование" Style="{StaticResource NavButton}" 
                            Click="NavigateToAdmin"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основное содержимое -->
        <Grid Grid.Row="1">
            <!-- Страница калькулятора -->
            <ScrollViewer x:Name="CalculatorPage" VerticalScrollBarVisibility="Auto" Margin="24,16,24,24">
                <StackPanel>
                    <!-- Заголовок калькулятора -->
                    <Border Style="{StaticResource CardStyle}" Background="{StaticResource PrimaryBrush}" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="Расчет покрытий" FontSize="20" FontWeight="Bold" 
                                       Foreground="White" Margin="0,0,0,12"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="➕ Добавить расчет" Style="{StaticResource PrimaryButton}" 
                                        Background="White" Foreground="{StaticResource PrimaryBrush}"
                                        BorderBrush="White"
                                        Click="AddCalculation_Click" Margin="0,0,12,0"/>
                                <Button Content="🗑️ Очистить все" Style="{StaticResource SecondaryButton}" 
                                        Background="Transparent" Foreground="White" BorderBrush="White"
                                        Click="ClearAll_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Таблица расчетов -->
                    <Border Style="{StaticResource CardStyle}" Padding="0">
                        <StackPanel>
                            <!-- Заголовок таблицы -->
                            <Border Background="#F9FAFB" CornerRadius="12,12,0,0" Padding="20,16" 
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="250"/>
                                        <ColumnDefinition Width="140"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="140"/>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="Тип покрытия" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="1" Text="Толщина, мм" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="Регион" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="3" Text="Площадь, м²" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="4" Text="Итоговая стоимость" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="5" Text="Цена за м²" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Grid>
                            </Border>

                            <!-- Строки расчетов -->
                            <ItemsControl ItemsSource="{Binding CoverageItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <!-- Основная строка расчета -->
                                            <Border Style="{StaticResource TableRowStyle}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="250"/>
                                                        <ColumnDefinition Width="140"/>
                                                        <ColumnDefinition Width="120"/>
                                                        <ColumnDefinition Width="140"/>
                                                        <ColumnDefinition Width="180"/>
                                                        <ColumnDefinition Width="120"/>
                                                        <ColumnDefinition Width="100"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Тип покрытия -->
                                                    <ComboBox Grid.Column="0" 
                                                              SelectedItem="{Binding Type, UpdateSourceTrigger=PropertyChanged}"
                                                              ItemsSource="{Binding AvailableTypes}"
                                                              Style="{StaticResource ModernComboBox}"
                                                              Margin="0,0,12,0"/>

                                                    <!-- Толщина -->
                                                    <ComboBox Grid.Column="1" 
                                                              SelectedItem="{Binding Thickness, UpdateSourceTrigger=PropertyChanged}"
                                                              ItemsSource="{Binding AvailableThicknesses}"
                                                              Style="{StaticResource ModernComboBox}"
                                                              Margin="0,0,12,0"/>

                                                    <!-- Регион -->
                                                    <ComboBox Grid.Column="2" 
                                                              SelectedItem="{Binding Region, UpdateSourceTrigger=PropertyChanged}"
                                                              ItemsSource="{Binding AvailableRegions}"
                                                              Style="{StaticResource ModernComboBox}"
                                                              Margin="0,0,12,0"/>

                                                    <!-- Площадь -->
                                                    <TextBox Grid.Column="3" 
                                                             Text="{Binding Area, UpdateSourceTrigger=PropertyChanged}" 
                                                             Style="{StaticResource ModernTextBox}" 
                                                             Margin="0,0,12,0"/>

                                                    <!-- Итоговая стоимость -->
                                                    <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding FinalCost, StringFormat='{}{0:N0}'}" 
                                                                   FontSize="16" FontWeight="Bold" 
                                                                   Foreground="{StaticResource PrimaryBrush}"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBlock Text=" ₽" 
                                                                   FontSize="16" FontWeight="Bold" 
                                                                   Foreground="{StaticResource PrimaryBrush}"
                                                                   VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Цена за м² -->
                                                    <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding FinalPricePerSquareMeter, StringFormat='{}{0:N0}'}" 
                                                                   FontSize="14" FontWeight="Medium" 
                                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBlock Text=" ₽/м²" 
                                                                   FontSize="12" FontWeight="Medium" 
                                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                                   VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Кнопки действий -->
                                                    <StackPanel Grid.Column="4" Orientation="Horizontal"  Margin="0,0,20,0"
                                                                HorizontalAlignment="Right" VerticalAlignment="Center">
                                                        <!-- Кнопка копирования -->
                                                        <Button Style="{StaticResource ActionButton}"
                                                                Tag="{Binding}" Click="CopyResult_Click"
                                                                ToolTip="Копировать результат"
                                                                Margin="0,0,8,0">
                                                            <!-- Иконка копирования -->
                                                            <Grid Width="16" Height="16">
                                                                <Rectangle Width="10" Height="12" 
                                                                           Stroke="{StaticResource TextSecondaryBrush}" 
                                                                           StrokeThickness="1.5" 
                                                                           Fill="Transparent"
                                                                           RadiusX="1" RadiusY="1"
                                                                           Margin="0,0,4,4"/>
                                                                <Rectangle Width="10" Height="12" 
                                                                           Stroke="{StaticResource TextSecondaryBrush}" 
                                                                           StrokeThickness="1.5" 
                                                                           Fill="White"
                                                                           RadiusX="1" RadiusY="1"
                                                                           Margin="4,4,0,0"/>
                                                            </Grid>
                                                        </Button>
                                                    </StackPanel>
                                                    <!-- Кнопка удаления -->
                                                    <StackPanel Grid.Column="6" Orientation="Horizontal" 
                                                             HorizontalAlignment="Left" VerticalAlignment="Center">
                                                        <Button 
                                                                Tag="{Binding}" Click="DeleteCalculation_Click"
                                                                ToolTip="Удалить этот расчет"
                                                                Background="#FEF2F2" BorderBrush="#FECACA">
                                                            <Button.Style>
                                                                <Style TargetType="Button" BasedOn="{StaticResource ActionButton}">
                                                                    <Setter Property="Background" Value="#FEF2F2"/>
                                                                    <Setter Property="BorderBrush" Value="#FECACA"/>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                                                            <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Button.Style>
                                                            <!-- Иконка мусорной корзины -->
                                                            <Grid Width="16" Height="16">
                                                                <Rectangle Width="12" Height="10" 
                                                                           Stroke="{StaticResource ErrorBrush}" 
                                                                           StrokeThickness="1.5" 
                                                                           Fill="Transparent"
                                                                           RadiusX="1" RadiusY="1"
                                                                           Margin="2,4,2,2"/>
                                                                <Rectangle Width="8" Height="2" 
                                                                           Fill="{StaticResource ErrorBrush}"
                                                                           Margin="4,2,4,12"/>
                                                                <Line X1="6" Y1="6" X2="6" Y2="11" 
                                                                      Stroke="{StaticResource ErrorBrush}" 
                                                                      StrokeThickness="1"/>
                                                                <Line X1="8" Y1="6" X2="8" Y2="11" 
                                                                      Stroke="{StaticResource ErrorBrush}" 
                                                                      StrokeThickness="1"/>
                                                                <Line X1="10" Y1="6" X2="10" Y2="11" 
                                                                      Stroke="{StaticResource ErrorBrush}" 
                                                                      StrokeThickness="1"/>
                                                            </Grid>
                                                        </Button>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>

                                            <!-- Сообщение об ошибке -->
                                            <Border Style="{StaticResource ErrorCardStyle}" 
                                                    Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                    Margin="20,0,20,12">
                                                <StackPanel Orientation="Horizontal">
                                                    <Border Background="{StaticResource ErrorBrush}" 
                                                            Width="24" Height="24" CornerRadius="12" 
                                                            Margin="0,0,12,0" VerticalAlignment="Top">
                                                        <TextBlock Text="!" FontSize="14" FontWeight="Bold" 
                                                                   Foreground="White" HorizontalAlignment="Center" 
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding ErrorMessage}" 
                                                               FontSize="14" FontWeight="Medium"
                                                               Foreground="{StaticResource ErrorBrush}"
                                                               TextWrapping="Wrap" VerticalAlignment="Center"
                                                               LineHeight="20"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Страница администрирования -->
            <ScrollViewer x:Name="AdminPage" VerticalScrollBarVisibility="Auto" Margin="24,16,24,24" Visibility="Collapsed">
                <StackPanel>
                    <!-- Заголовок админ-панели -->
                    <Border Style="{StaticResource CardStyle}" Background="#8B5CF6" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="Административная панель" FontSize="20" FontWeight="Bold" 
                                       Foreground="White" Margin="0,0,0,12"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="💾 Сохранить изменения" Style="{StaticResource PrimaryButton}" 
                                        Background="White" Foreground="#8B5CF6"
                                        BorderBrush="White"
                                        Click="SavePrices_Click" Margin="0,0,12,0"/>
                                <Button Content="🔄 Сбросить к умолчанию" Style="{StaticResource SecondaryButton}" 
                                        Background="Transparent" Foreground="White" BorderBrush="White"
                                        Click="ResetPrices_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Управление ценами -->
                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24" Padding="0">
                        <StackPanel>
                            <!-- Заголовок секции -->
                            <Border Background="#F9FAFB" CornerRadius="12,12,0,0" Padding="24,20" 
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                                <TextBlock Text="📊 Управление ценами" FontSize="18" FontWeight="Bold" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                            </Border>

                            <!-- Заголовки колонок -->
                            <Border Background="#FAFBFC" Padding="24,16" 
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="250"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="Тип покрытия" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="1" Text="Толщина" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="Стоимость" FontWeight="SemiBold" FontSize="14" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Grid>
                            </Border>

                            <!-- Список цен -->
                            <ItemsControl x:Name="PriceItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource TableRowStyle}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="250"/>
                                                    <ColumnDefinition Width="150"/>
                                                    <ColumnDefinition Width="180"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Тип покрытия -->
                                                <TextBlock Grid.Column="0" Text="{Binding Type}" 
                                                           FontSize="14" FontWeight="Medium"
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           VerticalAlignment="Center"/>

                                                <!-- Толщина -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <Border Background="#E5E7EB" CornerRadius="4" Padding="8,4" HorizontalAlignment="Left">
                                                        <TextBlock Text="{Binding Thickness}" 
                                                                   FontSize="12" FontWeight="Medium"
                                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    </Border>
                                                </StackPanel>

                                                <!-- Цена -->
                                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBox Text="{Binding Price, UpdateSourceTrigger=PropertyChanged}" 
                                                             Style="{StaticResource ModernTextBox}" 
                                                             Width="120" Margin="0,0,8,0"/>
                                                    <TextBlock Text="₽/м²" 
                                                               FontSize="14" FontWeight="Medium"
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Смена пароля -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="🔑 Смена пароля администратора" FontSize="18" FontWeight="Bold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,20"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="270"/>
                                    <ColumnDefinition Width="270"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Текущий пароль -->
                                <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,16,0">
                                    <TextBlock Text="Текущий пароль" FontSize="14" FontWeight="Medium"
                                               Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                    <Grid Style="{StaticResource PasswordContainerStyle}">
                                        <PasswordBox x:Name="CurrentPasswordBox" 
                                                     Style="{StaticResource ModernPasswordBox}"/>
                                        <TextBox x:Name="CurrentPasswordTextBox" 
                                                 Style="{StaticResource ModernTextBox}"
                                                 Visibility="Collapsed"/>
                                        <Button x:Name="CurrentPasswordToggle"
                                                Style="{StaticResource PasswordToggleButton}"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Margin="0,0,5,0"
                                                Click="ToggleCurrentPasswordVisibility"
                                                ToolTip="Показать/скрыть пароль">
                                            <!-- Иконка глаза -->
                                            <Grid Width="16" Height="16">
                                                <!-- Закрытый глаз (по умолчанию) -->
                                                <Canvas x:Name="CurrentEyeClosedIcon" Visibility="Visible">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6" Canvas.Top="6" Width="4" Height="4" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                    <!-- Линия перечеркивания -->
                                                    <Line X1="2" Y1="2" X2="14" Y2="14" 
                                                          Stroke="{StaticResource TextSecondaryBrush}" 
                                                          StrokeThickness="1.5"/>
                                                </Canvas>
                                                <!-- Открытый глаз -->
                                                <Canvas x:Name="CurrentEyeOpenIcon" Visibility="Collapsed">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Белок глаза -->
                                                    <Ellipse Canvas.Left="5" Canvas.Top="5" Width="6" Height="6" 
                                                             Fill="White"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6.5" Canvas.Top="6.5" Width="3" Height="3" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                </Canvas>
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- Новый пароль -->
                                <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,16,0">
                                    <TextBlock Text="Новый пароль" FontSize="14" FontWeight="Medium"
                                               Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                    <Grid Style="{StaticResource PasswordContainerStyle}">
                                        <PasswordBox x:Name="NewPasswordBox" 
                                                     Style="{StaticResource ModernPasswordBox}"/>
                                        <TextBox x:Name="NewPasswordTextBox" 
                                                 Style="{StaticResource ModernTextBox}"
                                                 Visibility="Collapsed"/>
                                        <Button x:Name="NewPasswordToggle"
                                                Style="{StaticResource PasswordToggleButton}"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Margin="0,0,5,0"
                                                Click="ToggleNewPasswordVisibility"
                                                ToolTip="Показать/скрыть пароль">
                                            <!-- Иконка глаза -->
                                            <Grid Width="16" Height="16">
                                                <!-- Закрытый глаз (по умолчанию) -->
                                                <Canvas x:Name="NewEyeClosedIcon" Visibility="Visible">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6" Canvas.Top="6" Width="4" Height="4" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                    <!-- Линия перечеркивания -->
                                                    <Line X1="2" Y1="2" X2="14" Y2="14" 
                                                          Stroke="{StaticResource TextSecondaryBrush}" 
                                                          StrokeThickness="1.5"/>
                                                </Canvas>
                                                <!-- Открытый глаз -->
                                                <Canvas x:Name="NewEyeOpenIcon" Visibility="Collapsed">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Белок глаза -->
                                                    <Ellipse Canvas.Left="5" Canvas.Top="5" Width="6" Height="6" 
                                                             Fill="White"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6.5" Canvas.Top="6.5" Width="3" Height="3" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                </Canvas>
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- Подтверждение нового пароля -->
                                <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,16,0">
                                    <TextBlock Text="Подтвердите новый пароль" FontSize="14" FontWeight="Medium"
                                               Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                    <Grid Style="{StaticResource PasswordContainerStyle}">
                                        <PasswordBox x:Name="ConfirmPasswordBox" 
                                                     Style="{StaticResource ModernPasswordBox}"/>
                                        <TextBox x:Name="ConfirmPasswordTextBox" 
                                                 Style="{StaticResource ModernTextBox}"
                                                 Visibility="Collapsed"/>
                                        <Button x:Name="ConfirmPasswordToggle"
                                                Style="{StaticResource PasswordToggleButton}"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Margin="0,0,5,0"
                                                Click="ToggleConfirmPasswordVisibility"
                                                ToolTip="Показать/скрыть пароль">
                                            <!-- Иконка глаза -->
                                            <Grid Width="16" Height="16">
                                                <!-- Закрытый глаз (по умолчанию) -->
                                                <Canvas x:Name="ConfirmEyeClosedIcon" Visibility="Visible">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6" Canvas.Top="6" Width="4" Height="4" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                    <!-- Линия перечеркивания -->
                                                    <Line X1="2" Y1="2" X2="14" Y2="14" 
                                                          Stroke="{StaticResource TextSecondaryBrush}" 
                                                          StrokeThickness="1.5"/>
                                                </Canvas>
                                                <!-- Открытый глаз -->
                                                <Canvas x:Name="ConfirmEyeOpenIcon" Visibility="Collapsed">
                                                    <!-- Глаз -->
                                                    <Path Fill="{StaticResource TextSecondaryBrush}" 
                                                          Data="M1,8 C1,8 3.5,3 8,3 C12.5,3 15,8 15,8 C15,8 12.5,13 8,13 C3.5,13 1,8 1,8 Z"/>
                                                    <!-- Белок глаза -->
                                                    <Ellipse Canvas.Left="5" Canvas.Top="5" Width="6" Height="6" 
                                                             Fill="White"/>
                                                    <!-- Зрачок -->
                                                    <Ellipse Canvas.Left="6.5" Canvas.Top="6.5" Width="3" Height="3" 
                                                             Fill="{StaticResource TextSecondaryBrush}"/>
                                                </Canvas>
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- Кнопки управления -->
                                <StackPanel Grid.Column="1" Grid.Row="1" Margin="0,0,16,0" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="✓ Изменить" Style="{StaticResource PrimaryButton}" 
                                            Click="ChangePasswordClick" Margin="0,0,8,0"/>
                                    <Button Content="↺ Сброс" Style="{StaticResource SecondaryButton}" 
                                            Background="#F59E0B" Foreground="White" BorderBrush="#F59E0B"
                                            Click="ResetPasswordClick"/>
                                </StackPanel>

                                <!-- Информация -->
                                <Border Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="4" 
                                        Background="#EFF6FF" BorderBrush="#DBEAFE" BorderThickness="1" 
                                        CornerRadius="8" Padding="16" Margin="0,20,0,0">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#3B82F6" Width="20" Height="20" CornerRadius="10" Margin="0,0,8,0">
                                                <TextBlock Text="i" FontSize="12" FontWeight="Bold" 
                                                           Foreground="White" HorizontalAlignment="Center" 
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Справочная информация" FontSize="14" FontWeight="SemiBold" 
                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                        </StackPanel>
                                        <TextBlock FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" LineHeight="18">
                                            <Run Text="• Минимальная длина пароля: 3 символа"/>
                                            <LineBreak/>
                                            <Run Text="• Пароль по умолчанию: admin123"/>
                                            <LineBreak/>
                                            <Run Text="• Пароль и настройки сохраняются в папке пользователя AppData"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <!-- Сообщение об ошибке -->
                                <Border x:Name="ErrorMessage" 
                                        Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="4"
                                        Style="{StaticResource ErrorCardStyle}"
                                        Visibility="Collapsed" Margin="0,16,0,0">
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="{StaticResource ErrorBrush}" 
                                                Width="20" Height="20" CornerRadius="10" 
                                                Margin="0,0,8,0">
                                            <TextBlock Text="!" FontSize="12" FontWeight="Bold" 
                                                       Foreground="White" HorizontalAlignment="Center" 
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                        <TextBlock x:Name="ErrorMessageText"
                                                   FontSize="13" FontWeight="Medium"
                                                   Foreground="{StaticResource ErrorBrush}"
                                                   TextWrapping="Wrap" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>
